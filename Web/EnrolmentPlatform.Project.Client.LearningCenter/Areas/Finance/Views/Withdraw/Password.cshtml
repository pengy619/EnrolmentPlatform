
@{
    ViewBag.Title = "提现密码设置";
    Layout = "~/Views/Shared/_Layout.cshtml";
}

<div class="main-wrap pass-style">
    <div class="panel">
        <div class="panel-body">
            <div  class="layui-form" >
                <div class="layui-form-item">
                    <label class="layui-form-label">账户手机号</label>
                    <div class="layui-form-mid layui-word-aux">@ViewBag.Phone</div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">提现密码</label>
                    <div class="layui-input-inline">
                        <input type="password" id="Password" name="Password" lay-verify="required|pass" placeholder="请输入密码" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">重复提现密码</label>
                    <div class="layui-input-inline">
                        <input type="password" name="regPassword" lay-verify="regPwd" placeholder="请输入密码" autocomplete="off" class="layui-input">
                    </div>
                </div>
                <div class="layui-form-item">
                    <label class="layui-form-label">验证码</label>
                    <div class="layui-input-inline">
                        <input type="text" placeholder="请输入验证码" id="VerificationCode" name="VerificationCode" autocomplete="off" class="layui-input">
                    </div>
                    <button type="button" class="layui-btn layui-btn-warm layui-btn-sm btn-style" id="btnSendCode" lay-fiilter="sendcode">获取验证码</button>
                </div>
                <div class="layui-form-item">
                    <div class="layui-input-block">
                        <button class="layui-btn layui-btn-warm" lay-submit="" lay-filter="application">确认设置</button>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

@section scripts{
    <script type="text/javascript">

        //验证码计时器
        var timer = null;
        function verifyCodeTimer() {
            var sconed = parseInt($("#btnSendCode").attr("tip"));
            if (sconed == 1) {
                $("#btnSendCode").text("获取验证码").removeClass("layui-disabled").attr("tip", "0").removeAttr("disabled");
                window.clearInterval(timer);
            }
            else {
                sconed = sconed - 1;
                $("#btnSendCode").text(sconed + "秒重发").attr("tip", sconed);
            }
        }



        layui.use(['form', 'jquery'], function () {
            var $ = layui.jquery;
            var form = layui.form;
            form.verify({
                pass: function (value, item) { //value：表单的值、item：表单的DOM对象
                    if (value.length < 6) {
                        return '密码最少6位。';
                    }
                    if (/^[a-zA-Z0-9_]+$/.test(value) == false) {
                        return '密码只能为数字字母和下划线。';
                    }
                    if (/^\d+$/.test(value)) {
                        return '密码不能全为数字。';
                    }
                }
                ,regPwd: function (value) {
                    //获取密码
                    var pwd = $("#Password").val();
                    if (pwd != value) {
                        return '两次输入的密码不一致';
                    }
                }
            });

                    //发送验证码
            $("#btnSendCode").on('click', function (data) {
                //var sendBtn = data.elem;
                $(this).text("60秒重发").addClass("layui-disabled").attr("tip", "60").prop("disabled", true);
                timer = window.setInterval("verifyCodeTimer();", 999);

                var ret;
                $.ajax({
                    type: "POST",                    
                    dataType: "json",
                    async: false,
                    data: { phone:"@ViewBag.Phone"},
                    url: '@Url.Action("SendVeriyCode", "Withdraw")',
                    success: function (result) {
                    }
                });
                return false;
            });
            // 提交事件
            form.on("submit(application)", function (data) {                
                var postData = {};
                postData.password = $("#Password").val();
                postData.code = $("#VerificationCode").val();
                $.ajax({
                    url: "@Url.Action("Password", "Withdraw")",
                    type: "post",
                    data: postData,
                    dataType: "json",
                    success: function (res) {
                        if (res.IsSuccess) {
                            layer.msg("操作成功", {
                                icon: 1
                                , time: 2000
                            });
                        } else {
                            layer.msg(res.Info, {
                                icon: 2
                                , time: 2000
                            });
                        }
                    }
                });
            })


        });

    </script>
}